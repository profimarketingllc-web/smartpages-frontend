---
import { useState } from 'astro/jsx-runtime';
---

<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SmartPages Login</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <style>
      :root {
        --navy: #1E2A45;
        --yellow: #F5B400;
        --orange: #E47E00;
        --lila1: #4B3CFB;
        --lila2: #6E5FFB;
        --aqua1: #4EC5C1;
        --aqua2: #2CA0C4;
        --white: #ffffff;
        --gray: #f5f5f5;
      }

      body {
        margin: 0;
        font-family: 'Segoe UI', sans-serif;
        background-color: var(--gray);
        color: var(--navy);
      }

      header {
        background: var(--navy);
        color: white;
        padding: 1.8rem 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 1rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.25);
      }

      header img {
        height: 120px;
        width: 120px;
      }

      header .text-block {
        display: flex;
        flex-direction: column;
      }

      header .text-block h1 {
        margin: 0;
        font-size: 2rem;
        font-weight: 700;
      }

      header .text-block p {
        margin: 0;
        font-size: 1rem;
        color: #ddd;
      }

      main {
        max-width: 1100px;
        margin: 3rem auto;
        padding: 0 2rem;
      }

      .hero {
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
        justify-content: center;
        align-items: stretch;
        margin-bottom: 3rem;
      }

      .hero .welcome,
      .hero .login-box {
        flex: 1;
        min-width: 300px;
        background: white;
        border-radius: 1rem;
        padding: 2rem;
        box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      }

      .hero .welcome h2 {
        font-size: 1.8rem;
        color: var(--yellow);
        margin-bottom: 0.3rem;
      }

      .hero .welcome h3 {
        font-size: 1.8rem;
        color: var(--navy);
        margin-top: 0;
      }

      .hero .welcome p {
        line-height: 1.5;
      }

      form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      input[type="text"],
      input[type="email"] {
        padding: 0.8rem;
        border-radius: 8px;
        border: 1px solid #ccc;
        font-size: 1rem;
        width: 100%;
      }

      label {
        font-weight: 600;
      }

      .checkbox {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      button {
        background: linear-gradient(135deg, var(--yellow), var(--orange));
        border: none;
        color: white;
        font-size: 1.1rem;
        font-weight: 600;
        padding: 0.9rem;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      button:hover {
        transform: scale(1.03);
        box-shadow: 0 6px 16px rgba(0,0,0,0.2);
      }

      .products {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 1.5rem;
      }

      .product {
        color: white;
        border-radius: 1rem;
        padding: 1.5rem;
        box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        transition: all 0.3s ease;
      }

      .product:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 25px rgba(0,0,0,0.25);
      }

      .p-profile {
        background: linear-gradient(135deg, var(--lila1), var(--lila2));
      }

      .p-page {
        background: linear-gradient(135deg, var(--yellow), var(--orange));
      }

      .p-domain {
        background: linear-gradient(135deg, var(--aqua1), var(--aqua2));
      }

      footer {
        text-align: center;
        margin: 4rem 0 2rem;
        color: #777;
        font-size: 0.9rem;
      }
    </style>
  </head>

  <body>
    <header>
      <img src="/SmartPages_icon_transparent.png" alt="SmartPages Logo" />
      <div class="text-block">
        <h1>SmartPages</h1>
        <p>Wir bringen dich in 10 Minuten online – ohne Technik Wissen</p>
      </div>
    </header>

    <main>
      <section class="hero">
        <div class="welcome">
          <h2>Herzlich Willkommen</h2>
          <h3>bei SmartPages</h3>
          <p>
            Mit SmartPages startest du in nur wenigen Minuten dein eigenes digitales Zuhause.
            Wir senden dir deinen persönlichen <strong>Magic-Link</strong>, mit dem du direkt in dein Dashboard gelangst – ohne Passwort oder komplizierte Registrierung.
            Gib einfach deine Basisdaten ein, damit dein Account korrekt zugeordnet werden kann.
            Du entscheidest, ob du SmartPages privat oder geschäftlich nutzt – der Zugang ist in beiden Fällen kostenlos in der Testphase.
          </p>
        </div>

        <div class="login-box">
          <form id="magicForm">
            <label for="first_name">Vorname *</label>
            <input type="text" id="first_name" name="first_name" required />

            <label for="last_name">Nachname</label>
            <input type="text" id="last_name" name="last_name" />

            <label for="email">E-Mail *</label>
            <input type="email" id="email" name="email" required />

            <div class="checkbox">
              <input type="checkbox" id="is_business" name="is_business" />
              <label for="is_business">Das ist ein Firmenkonto (Business)</label>
            </div>

            <div id="company_field" style="display:none;">
              <label for="company_name">Firmenname</label>
              <input type="text" id="company_name" name="company_name" />
            </div>

            <button type="submit">Magic-Link senden</button>
          </form>
        </div>
      </section>

      <section class="products">
        <div class="product p-profile">
          <h3>SmartProfile</h3>
          <p>Erstelle in Minuten deine zentrale Profilseite mit Branding, Links & Kontakt – ideal für Creator, Influencer und Solopreneure.</p>
        </div>

        <div class="product p-page">
          <h3>SmartPage</h3>
          <p>Deine persönliche Subdomain mit bis zu 5 frei gestaltbaren Unterseiten. Präsentiere Produkte, Dienstleistungen oder Projekte – individuell & professionell.</p>
        </div>

        <div class="product p-domain">
          <h3>SmartDomain</h3>
          <p>Gestalte deine eigene Homepage mit deinem Namen und entwickle sie ganz individuell mit unseren Bausteinen.</p>
        </div>
      </section>
    </main>

    <footer>
      © 2025 SmartPages · Profi Marketing LLC · DSGVO-konform in Europa gehostet
    </footer>

    <script>
      const businessCheckbox = document.getElementById('is_business');
      const companyField = document.getElementById('company_field');
      const form = document.getElementById('magicForm');

      businessCheckbox.addEventListener('change', () => {
        companyField.style.display = businessCheckbox.checked ? 'block' : 'none';
      });

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const data = {
          first_name: form.first_name.value,
          last_name: form.last_name.value,
          email: form.email.value,
          company_name: form.company_name.value,
          is_business: businessCheckbox.checked
        };

        try {
          const res = await fetch('https://smartcore.profi-marketing-llc.workers.dev/api/auth/start', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });

          const result = await res.json();
          if (result.ok) {
            alert('✅ Magic-Link wurde gesendet! Bitte prüfe dein E-Mail-Postfach.');
            form.reset();
            companyField.style.display = 'none';
          } else {
            alert('❌ Fehler: ' + (result.message || result.error || 'Unbekannter Fehler'));
          }
        } catch (err) {
          alert('❌ Serverfehler: ' + err.message);
        }
      });
    </script>
  </body>
</html>
